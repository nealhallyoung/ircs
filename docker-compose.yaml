services:
  redis:
      container_name: redis
      image: redis
      restart: always
      networks:
        - docker-registry
      command: redis-server --maxmemory 512m
  k8s:
    container_name: k8s
    image: registry:2.8.3
    restart: always
    networks:
      - docker-registry
    volumes:
      - ./data:/var/lib/registry
      - ./config.yml:/etc/docker/registry/config.yml
  nginx:
    container_name: nginx
    image: nginx:alpine
    restart: always
    networks:
      - docker-registry
    ports:
        - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
      - ./cert:/etc/nginx/cert

networks:
  docker-registry:
    driver: bridge
